# Cocoapods

This folder contains an experiment to see if we can keep using Cocoapods to generate the `ReactNative.xcframework` prebuild.
This will give us more time to work on a proper solution because the XCFramework can be shipped with any other mechanism, either Cocoapods or SPM.

This folder contain two subfolders:
- CocoapodsApp
- CocoapodsLibrary

## CocoapodsApp

The CocoapodApp is a folder that contains an app generated by Xcode. This is a default Xcode app created by the IDE, with no customization.

This is the test bed that we use to drag and drop the generated xcframework and to verify that the app builds and run and that can access the symbols of the xcframework.

## CocoapodsLibrary

This folder contains the usual setup we are using for testing:
- a `ReactNativeRenderer` library
- a top level ReactNative library that will contains all the symbols and all the Headers that we need to integrate in an app.

### ReactNativeRenderer

The react Renderer library follows the usual structure: we have our `ReactRenderer.h` and `ReactRenderer.cpp` files in the `react/renderer` path.

It also contains a very basic `ReactNativeRenderer.podspec` file to let Cocoapods integrate the library into another target.

### ReactNative

This folder contains the high level framework that we want to generate as a single prebuild.
Aside from the usual dummy files, which are here called `RCTReactNative.h` and `RCTReactNative.mm`, it contains an `xcodeproj` and a `Podfile`. Both are required by Cocoapods to intgrate the dependencies into the framework.

## Tests I run

First I tried to build the ReactNative framework and verified that it built. From the Cocoapods/CocoapodsLibrary/ReactNative folder, just run:

```
pod install
open ReactNative.xcworkspace
```

To generate the xcworkspace and to open it.

Then press cmd+b to build, after selecting an iphone simulator.

Once the build ended, I looked in the derived data folder and I manually:
1. reached for the `Debug-iphonesimulator.framework` file
2. created a `Header/react/renderer` path in the framework
3. copied the `ReactNativeRenderer` in that path.

This prepared the Framework to be consumed by the app.

I then copied the framework into the App folder and opened the `CocoapodsApp/ReactNativeApp.xcodeproj`

I dragged and dropped the framework into the `Frameworks, Libraries, and Embedded Content` section.

I renamed the `ViewController.m` file to be named `ViewController.mm` file, so that it can compile C++ code.

Then I added the import:
```objc
#import <ReactNative/react/renderer/ReactRenderer.h>
```
and I tried to use the renderer in the `viewdidLoad` method.

```objc
@implementation ViewController
- (void)viewDidLoad {
  [super viewDidLoad];
  // Do any additional setup after loading the view.
  self.view.backgroundColor = [UIColor redColor];

  auto renderer = Renderer();
  renderer.render();
}
@end
```

The IDE was happy, as it could resolve all the symbols.
However, the compiler was not happy, and it failed with an error:
```
ðŸ›‘ Undefined symbol: Renderer:render()
```
This happens because the framework binary does not have all the symbols. This means that, when building, we cannot have a single binary with all the symbols and we would have to find a way to merge together the various executables that cocoapods generates.

As of today, we don't have a way to do it: it looks like there is no `SoMerger` equivalent for iOS's dylibs.

> ![CAUTION]
> For some reasons, it looks like the project can't build anymore.
> I don't think it provides much more information to try and make it build, given that we want to move away from Cocoapods anyway
